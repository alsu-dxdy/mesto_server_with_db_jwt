# Mesto-backend
Backend интерактивного приложения для публикации фото - Mesto. Т.к. реальный сервер в настоящее время остановлен, следует запускать локальную версию сервера.

### Стек проекта:
- Express 
- MongoDB
- JS ES6

### Инструкция по запуску backend:
#### Установка и запуск MongoDB на примере Windows
Это нужно сделать до запуска Express.js приложения (сервера). Иначе оно не сможет подключиться к базе данных и взаимодействовать с ней
1)	Скачать и распаковать архив с MongoDB:
https://www.mongodb.com/try/download/community?jmp=docs
2)	В папке с MongoDB  в терминале Git Bash  ввести:
```
mkdir data/db
```
3) В том же окне терминала выполнить команду:
```
cd bin/
```
4) Далее:
```
mongod --dbpath ../data/db
```
5) Открыть второе окно терминала, зайти в папку с MongoDB и выполнить команды:
```
cd bin/
```
затем
```
mongo
```
6) Итог: сервер MongoDB запущен.
При возникновении затруднений с установкой и запуском MongoDB рекомендую обратиться к этому [видео](https://youtu.be/2vujABNBFAY) (начиная с 12:40).

#### Установка и запуск сервера
1) Клонировать репозиторий:
```
git clone https://github.com/alsu-dxdy/mesto_server_with_db_jwt
```
2) Установить зависимости: в папке проекта в терминале ввести:
```
npm install
```
3) Запустить проект: в папке проекта в терминале ввести:
```
npm run dev
```
### Описание backend-части:
- в схеме пользователя есть обязательные email и password;
поле email уникально и валидируется;
- в контроллере createUser почта и хеш пароля записываются в базу;
- есть контроллер login, который проверяет полученные в теле запроса почту и пароль;
- если почта и пароль верные, контроллер login создаёт JWT, в пейлоуд которого записано свойство _id с идентификатором пользователя; срок жизни токена — 7 дней;
- если почта и пароль верные, контроллер login возвращает созданный токен в ответе;
- если почта и пароль не верные, контроллер login возвращает ошибку 401;
- в app.js есть обработчики POST-запросов на роуты /signin и /signup;
- есть файл middlewares/auth.js, в нём мидлвэр для проверки JWT;
- при правильном JWT авторизационный мидлвэр добавляет в объект запроса пейлоуд и пропускает запрос дальше;
- при неправильном JWT авторизационный мидвэр возвращает ошибку 401;
- все роуты, кроме /signin и /signup, защищены авторизацией;
- пользователь не может удалить карточку, которую он не создавал;
- API не возвращает хеш пароля.

### Инструкция по запуску frontend
находится [здесь](https://github.com/alsu-dxdy/mesto) 
